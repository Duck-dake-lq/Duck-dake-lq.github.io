<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="UTF-8">
    <title>简易蜘蛛纸牌</title>
    <style>
        body { background: #0a5c2c; font-family: Arial, sans-serif; }
        #gameArea { width: 900px; margin: 30px auto; }
        .column {
            display: inline-block;
            vertical-align: top;
            width: 60px;
            min-height: 400px;
            margin: 0 5px;
            background: rgba(255,255,255,0.05);
            border-radius: 6px;
            position: relative;
        }
        .card {
            width: 56px;
            height: 80px;
            background: #fff;
            border: 1px solid #333;
            border-radius: 6px;
            position: absolute;
            left: 2px;
            cursor: pointer;
            user-select: none;
            box-shadow: 1px 2px 4px #2224;
            text-align: center;
            font-size: 22px;
            line-height: 80px;
            color: #222;
            transition: box-shadow 0.1s;
        }
        .card.dragging {
            opacity: 0.7;
            z-index: 1000;
            box-shadow: 4px 8px 16px #2228;
        }
        #dealBtn {
            margin: 20px 0 10px 0;
            padding: 8px 30px;
            font-size: 18px;
            background: #f9d923;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }
        #finishArea {
            margin-top: 10px;
            min-height: 90px;
        }
        .finish-stack {
            display: inline-block;
            width: 56px;
            height: 80px;
            margin-right: 8px;
            background: #eee;
            border-radius: 6px;
            border: 1px solid #aaa;
            text-align: center;
            line-height: 80px;
            font-size: 20px;
            color: #333;
        }
        #msg { color: #fff; margin-top: 10px; font-size: 18px; }
    </style>
</head>
<body>
    <div id="gameArea">
        <button id="dealBtn">发牌</button>
        <div id="columns"></div>
        <div id="finishArea"></div>
        <div id="msg"></div>
    </div>
    <script>
        // 只用黑桃，单花色
        const suits = ['♠'];
        const values = [1,2,3,4,5,6,7,8,9,10,11,12,13];
        let deck = [];
        let columns = [];
        let finishStacks = [];
        let dragging = null;
        let offsetY = 0;

        function createDeck() {
            deck = [];
            // 8副牌
            for (let i = 0; i < 8; i++) {
                for (let v of values) {
                    deck.push({suit: '♠', value: v});
                }
            }
            // 洗牌
            for (let i = deck.length - 1; i > 0; i--) {
                let j = Math.floor(Math.random() * (i + 1));
                [deck[i], deck[j]] = [deck[j], deck[i]];
            }
        }

        function setupGame() {
            createDeck();
            columns = [];
            finishStacks = [];
            document.getElementById('columns').innerHTML = '';
            document.getElementById('finishArea').innerHTML = '';
            document.getElementById('msg').textContent = '';
            // 10列
            for (let i = 0; i < 10; i++) {
                columns.push([]);
                let colDiv = document.createElement('div');
                colDiv.className = 'column';
                colDiv.dataset.col = i;
                colDiv.addEventListener('dragover', e => e.preventDefault());
                colDiv.addEventListener('drop', onDrop);
                document.getElementById('columns').appendChild(colDiv);
            }
            // 初始发牌
            for (let i = 0; i < 54; i++) {
                columns[i % 10].push(deck.pop());
            }
            render();
        }

        function render() {
            // 渲染列
            let colDivs = document.querySelectorAll('.column');
            columns.forEach((col, i) => {
                let colDiv = colDivs[i];
                colDiv.innerHTML = '';
                col.forEach((card, idx) => {
                    let cardDiv = document.createElement('div');
                    cardDiv.className = 'card';
                    cardDiv.style.top = (idx * 22) + 'px';
                    cardDiv.textContent = card.value + card.suit;
                    cardDiv.draggable = true;
                    cardDiv.dataset.col = i;
                    cardDiv.dataset.idx = idx;
                    cardDiv.addEventListener('dragstart', onDragStart);
                    cardDiv.addEventListener('mousedown', onMouseDown);
                    colDiv.appendChild(cardDiv);
                });
            });
            // 渲染回收区
            let finishArea = document.getElementById('finishArea');
            finishArea.innerHTML = '';
            finishStacks.forEach(() => {
                let fs = document.createElement('div');
                fs.className = 'finish-stack';
                fs.textContent = '♠A~K';
                finishArea.appendChild(fs);
            });
        }

        function onDragStart(e) {
            // 禁用原生拖拽，使用自定义拖拽
            e.preventDefault();
        }

        function onMouseDown(e) {
            let cardDiv = e.target;
            let col = parseInt(cardDiv.dataset.col);
            let idx = parseInt(cardDiv.dataset.idx);
            // 只能拖动从该牌到最底下的连续递减序列
            let moving = columns[col].slice(idx);
            for (let i = 1; i < moving.length; i++) {
                if (moving[i].value !== moving[i-1].value - 1) return;
            }
            dragging = {col, idx, moving};
            offsetY = e.offsetY;
            let ghost = [];
            moving.forEach((card, i) => {
                let g = cardDiv.cloneNode(true);
                g.className += ' dragging';
                g.style.top = (e.clientY - offsetY + i*22 - gameArea.getBoundingClientRect().top) + 'px';
                g.style.left = (e.clientX - 20 - gameArea.getBoundingClientRect().left) + 'px';
                g.style.position = 'fixed';
                g.style.pointerEvents = 'none';
                document.body.appendChild(g);
                ghost.push(g);
            });
            function onMove(ev) {
                ghost.forEach((g, i) => {
                    g.style.top = (ev.clientY - offsetY + i*22) + 'px';
                    g.style.left = (ev.clientX - 20) + 'px';
                });
            }
            function onUp(ev) {
                document.removeEventListener('mousemove', onMove);
                document.removeEventListener('mouseup', onUp);
                ghost.forEach(g => document.body.removeChild(g));
                let dropCol = null;
                document.querySelectorAll('.column').forEach(colDiv => {
                    let rect = colDiv.getBoundingClientRect();
                    if (ev.clientX >= rect.left && ev.clientX <= rect.right &&
                        ev.clientY >= rect.top && ev.clientY <= rect.bottom) {
                        dropCol = parseInt(colDiv.dataset.col);
                    }
                });
                if (dropCol !== null && canDrop(dragging.moving, dropCol)) {
                    // 移动牌
                    let moved = columns[dragging.col].splice(dragging.idx);
                    columns[dropCol] = columns[dropCol].concat(moved);
                    checkFinish(dropCol);
                }
                render();
                dragging = null;
            }
            document.addEventListener('mousemove', onMove);
            document.addEventListener('mouseup', onUp);
        }

        function canDrop(moving, dropCol) {
            if (columns[dropCol].length === 0) return true;
            let last = columns[dropCol][columns[dropCol].length - 1];
            return last.value === moving[0].value + 1;
        }

        function onDrop(e) {
            // 禁用原生拖拽
            e.preventDefault();
        }

        function checkFinish(col) {
            // 检查是否有A~K顺序
            let stack = columns[col];
            if (stack.length < 13) return;
            let last13 = stack.slice(-13);
            for (let i = 0; i < 13; i++) {
                if (last13[i].value !== 13 - i) return;
            }
            // 移到回收区
            columns[col].splice(-13, 13);
            finishStacks.push(1);
            document.getElementById('msg').textContent = `成功收集一组A~K！已完成${finishStacks.length}组`;
            if (finishStacks.length === 8) {
                document.getElementById('msg').textContent = "恭喜你，全部完成！";
            }
        }

        document.getElementById('dealBtn').onclick = function() {
            // 每次发10张牌到每列底部
            if (deck.length < 10) {
                document.getElementById('msg').textContent = "没有可发的牌了！";
                return;
            }
            for (let i = 0; i < 10; i++) {
                columns[i].push(deck.pop());
            }
            render();
        };

        setupGame();
    </script>
</body>
</html>